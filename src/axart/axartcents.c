#include <dolphin/axart.h>
#include <dolphin/os.h>
#include <dolphin/mix.h>
#include "macros.h"

static f32 __AXLFOCentsTable[100] = {
   1.0f, 1.00058f, 1.00116f, 1.00173f, 1.00231f, 1.00289f, 1.00347f, 1.00405f,
   1.00463f, 1.00521f, 1.00579f, 1.00637f, 1.00696f, 1.00754f, 1.00812f, 1.0087f,
   1.00928f, 1.00987f, 1.01045f, 1.01103f, 1.01162f, 1.0122f, 1.01279f, 1.01337f,
   1.01396f, 1.01454f, 1.01513f, 1.01572f, 1.0163f, 1.01689f, 1.01748f, 1.01807f,
   1.01866f, 1.01924f, 1.01983f, 1.02042f, 1.02101f, 1.0216f, 1.02219f, 1.02278f,
   1.02337f, 1.02397f, 1.02456f, 1.02515f, 1.02574f, 1.02633f, 1.02693f, 1.02752f,
   1.02811f, 1.02871f, 1.0293f, 1.0299f, 1.03049f, 1.03109f, 1.03168f, 1.03228f,
   1.03288f, 1.03347f, 1.03407f, 1.03467f, 1.03526f, 1.03586f, 1.03646f, 1.03706f,
   1.03766f, 1.03826f, 1.03886f, 1.03946f, 1.04006f, 1.04066f, 1.04126f, 1.04186f,
   1.04247f, 1.04307f, 1.04367f, 1.04427f, 1.04488f, 1.04548f, 1.04609f, 1.04669f,
   1.04729f, 1.0479f, 1.0485f, 1.04911f, 1.04972f, 1.05032f, 1.05093f, 1.05154f,
   1.05215f, 1.05275f, 1.05336f, 1.05397f, 1.05458f, 1.05519f, 1.0558f, 1.05641f,
   1.05702f, 1.05763f, 1.05824f, 1.05885f,
};

static f32 __AXLFOOctavesTableUp[12] = {
   1.0f, 2.0f, 4.0f, 8.0f, 16.0f, 32.0f, 64.0f, 128.0f,
   256.0f, 512.0f, 1024.0f, 2048.0f,
};

static f32 __AXLFOSemitonesTableUp[12] = {
   1.0f, 1.05946f, 1.12246f, 1.18921f, 1.25992f, 1.33484f, 1.41421f, 1.49831f,
   1.5874f, 1.68179f, 1.7818f, 1.88775f,
};

static f32 __AXLFOSemitonesTableDown[128] = {
   1.0f, 0.943874f, 0.890899f, 0.840896f, 0.793701f, 0.749154f, 0.707107f, 0.66742f,
   0.629961f, 0.594604f, 0.561231f, 0.529732f, 0.5f, 0.471937f, 0.445449f, 0.420448f,
   0.39685f, 0.374577f, 0.353553f, 0.33371f, 0.31498f, 0.297302f, 0.280616f, 0.264866f,
   0.25f, 0.235969f, 0.222725f, 0.210224f, 0.198425f, 0.187288f, 0.176777f, 0.166855f,
   0.15749f, 0.148651f, 0.140308f, 0.132433f, 0.125f, 0.117984f, 0.111362f, 0.105112f,
   0.099213f, 0.093644f, 0.088388f, 0.083427f, 0.078745f, 0.074325f, 0.070154f, 0.066216f,
   0.0625f, 0.058992f, 0.055681f, 0.052556f, 0.049606f, 0.046822f, 0.044194f, 0.041714f,
   0.039373f, 0.037163f, 0.035077f, 0.033108f, 0.03125f, 0.029496f, 0.027841f, 0.026278f,
   0.024803f, 0.023411f, 0.022097f, 0.020857f, 0.019686f, 0.018581f, 0.017538f, 0.016554f,
   0.015625f, 0.014748f, 0.01392f, 0.013139f, 0.012402f, 0.011706f, 0.011049f, 0.010428f,
   0.009843f, 0.009291f, 0.008769f, 0.008277f, 0.007813f, 0.007374f, 0.00696f, 0.00657f,
   0.006201f, 0.005853f, 0.005524f, 0.005214f, 0.004922f, 0.004645f, 0.004385f, 0.004139f,
   0.003906f, 0.003687f, 0.00348f, 0.003285f, 0.0031f, 0.002926f, 0.002762f, 0.002607f,
   0.002461f, 0.002323f, 0.002192f, 0.002069f, 0.001953f, 0.001844f, 0.00174f, 0.001642f,
   0.00155f, 0.001463f, 0.001381f, 0.001304f, 0.00123f, 0.001161f, 0.001096f, 0.001035f,
   0.000977f, 0.000922f, 0.00087f, 0.000821f, 0.000775f, 0.000732f, 0.000691f, 0.000652f,
};

f32 AXARTCents(s32 cents) {
    if (cents > 0) {
        s32 octaves = cents / 1200;
        s32 semitones = (cents % 1200) / 100;
        cents %= 100;

        return __AXLFOOctavesTableUp[octaves] * __AXLFOSemitonesTableUp[semitones] * __AXLFOCentsTable[cents];
    } else if (cents < 0) {
        s32 semitones = cents / 100;
        cents %= 100;

        if (cents != 0) {
            cents += 100;
            semitones -= 1;
        }

        semitones *= -1;
        return __AXLFOSemitonesTableDown[semitones] * __AXLFOCentsTable[cents];
    } else {
        return 1.0f;
    }
}
